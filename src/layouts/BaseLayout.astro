---
export interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "Explorador dels plens del Consell Municipal de Barcelona",
} = Astro.props;

const { pathname } = Astro.url;
const base = import.meta.env.BASE_URL;

function isActive(href: string): boolean {
  // Home: exact match only
  if (href === base || href === `${base}/`) {
    return pathname === base || pathname === `${base}/`;
  }
  return pathname.startsWith(href);
}
---

<!doctype html>
<html lang="ca">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <title>{title} ‚Äî plens.barcelona</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href={`${import.meta.env.BASE_URL}favicon.svg`}
    />
  </head>
  <body>
    <header class="site-header">
      <div class="container site-header__inner">
        <a href={import.meta.env.BASE_URL} class="site-header__logo">
          <span class="site-header__logo-icon">üèõÔ∏è</span>
          <span class="site-header__logo-text">plens.barcelona</span>
        </a>
        <nav class="site-nav" id="site-nav" aria-label="Navegaci√≥ principal">
          <a
            href={`${base}sessions/`}
            class:list={[{ "is-active": isActive(`${base}sessions/`) }]}
            aria-current={isActive(`${base}sessions/`) ? "page" : undefined}
            >Sessions</a
          >
          <a
            href={`${base}regidors/`}
            class:list={[{ "is-active": isActive(`${base}regidors/`) }]}
            aria-current={isActive(`${base}regidors/`) ? "page" : undefined}
            >Regidors</a
          >
          <a
            href={`${base}temes/`}
            class:list={[{ "is-active": isActive(`${base}temes/`) }]}
            aria-current={isActive(`${base}temes/`) ? "page" : undefined}
            >Temes</a
          >
          <a
            href={`${base}retorica/`}
            class:list={[{ "is-active": isActive(`${base}retorica/`) }]}
            aria-current={isActive(`${base}retorica/`) ? "page" : undefined}
            >Ret√≤rica</a
          >
          <a
            href={`${base}about/`}
            class:list={[{ "is-active": isActive(`${base}about/`) }]}
            aria-current={isActive(`${base}about/`) ? "page" : undefined}
            >Projecte</a
          >
          <a
            href={`${base}intervencions/`}
            class:list={[
              "nav-search",
              { "is-active": isActive(`${base}intervencions/`) },
            ]}
            aria-label="Cercador"
            aria-current={isActive(`${base}intervencions/`)
              ? "page"
              : undefined}
          >
            <span class="nav-search__text">Cercador</span>
            <span class="nav-search__icon" aria-hidden="true">üîç</span>
          </a>
        </nav>
        <button
          class="nav-toggle"
          id="nav-toggle"
          aria-label="Obrir men√∫"
          aria-expanded="false"
        >
          <span class="nav-toggle__icon"></span>
        </button>
      </div>
    </header>

    <main class="container main-content">
      <slot />
    </main>

    <footer class="site-footer">
      <div class="container site-footer__inner">
        <div class="site-footer__brand">
          <span class="site-footer__logo">plens.barcelona</span>
          <p class="site-footer__tagline">
            Un projecte de <a
              href="https://rogersanjaume.cat"
              target="_blank"
              rel="noopener">rogersanjaume.cat</a
            >.
            <a
              href="https://github.com/catbru/plens-front"
              target="_blank"
              rel="noopener"
              class="github-link"
              aria-label="GitHub"
            >
              <svg
                viewBox="0 0 24 24"
                width="20"
                height="20"
                fill="currentColor"
              >
                <path
                  d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                ></path>
              </svg>
            </a>
          </p>
        </div>
        <nav class="site-footer__nav" aria-label="Navegaci√≥ peu de p√†gina">
          <a href={`${base}sessions/`}>Sessions</a>
          <a href={`${base}regidors/`}>Regidors</a>
          <a href={`${base}temes/`}>Temes</a>
          <a href={`${base}retorica/`}>Ret√≤rica</a>
          <a href={`${base}intervencions/`}>Cercador</a>
          <a href={`${base}about/`}>Sobre el projecte</a>
        </nav>
      </div>
    </footer>

    <style is:global>
      @import "../styles/global.css";

      .site-header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-bottom: 1px solid var(--c-border);
        box-shadow: 0 1px 0 var(--c-border-light);
        height: var(--header-height);
      }
      .site-header__inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
      }
      .site-header__logo {
        display: flex;
        align-items: center;
        gap: var(--s-sm);
        color: var(--c-text);
        font-weight: 700;
        font-size: var(--fs-lg);
      }
      .site-header__logo:hover {
        color: var(--c-accent);
      }
      .site-header__logo-icon {
        font-size: 1.5rem;
      }

      .site-nav {
        display: flex;
        gap: var(--s-lg);
      }
      .site-nav a {
        color: var(--c-text-muted);
        font-weight: 500;
        font-size: var(--fs-sm);
        padding: var(--s-xs) 0;
        border-bottom: 2px solid transparent;
        transition:
          color 0.15s,
          border-color 0.15s;
      }
      .site-nav a:hover {
        color: var(--c-text);
        border-bottom-color: var(--c-border);
      }
      .site-nav a.is-active {
        color: var(--c-accent);
        border-bottom-color: var(--c-accent);
        font-weight: 600;
      }

      /* Search icon styling */
      .nav-search__icon {
        display: none;
      }

      @media (min-width: 769px) {
        .nav-search__text {
          display: none;
        }
        .nav-search__icon {
          display: inline-block;
          font-size: 1.25rem;
        }
        /* Visual separator for search icon */
        .nav-search {
          border-bottom: none !important; /* No underline for icon */
          margin-left: var(--s-sm);
          padding-left: var(--s-lg) !important;
          border-left: 1px solid var(--c-border);
          display: flex;
          align-items: center;
        }
        .nav-search:hover {
          color: var(--c-accent);
          transform: scale(1.1);
        }
      }

      /* Hamburger toggle ‚Äî hidden on desktop */
      .nav-toggle {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: var(--s-sm);
        z-index: 110;
      }
      .nav-toggle__icon,
      .nav-toggle__icon::before,
      .nav-toggle__icon::after {
        display: block;
        width: 22px;
        height: 2px;
        background: var(--c-text);
        border-radius: 2px;
        transition: all 0.25s ease;
        position: relative;
      }
      .nav-toggle__icon::before,
      .nav-toggle__icon::after {
        content: "";
        position: absolute;
        left: 0;
        width: 22px;
      }
      .nav-toggle__icon::before {
        top: -7px;
      }
      .nav-toggle__icon::after {
        top: 7px;
      }
      /* Animate to X when open */
      .nav-toggle[aria-expanded="true"] .nav-toggle__icon {
        background: transparent;
      }
      .nav-toggle[aria-expanded="true"] .nav-toggle__icon::before {
        top: 0;
        transform: rotate(45deg);
      }
      .nav-toggle[aria-expanded="true"] .nav-toggle__icon::after {
        top: 0;
        transform: rotate(-45deg);
      }

      .main-content {
        min-height: calc(100vh - var(--header-height) - 120px);
        padding-top: var(--s-lg);
        padding-bottom: var(--s-2xl);
      }

      .site-footer {
        background: var(--c-bg-alt);
        border-top: 1px solid var(--c-border);
        padding: var(--s-2xl) 0;
        margin-top: var(--s-2xl);
      }
      .site-footer__inner {
        display: flex;
        gap: var(--s-2xl);
        align-items: flex-start;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .site-footer__brand {
        max-width: 340px;
      }
      .site-footer__logo {
        font-weight: 700;
        font-size: var(--fs-base);
        color: var(--c-text);
        display: block;
        margin-bottom: var(--s-sm);
      }
      .site-footer__tagline {
        font-size: var(--fs-xs);
        color: var(--c-text-muted);
        line-height: 1.6;
      }
      .site-footer__nav {
        display: flex;
        flex-wrap: wrap;
        gap: var(--s-sm) var(--s-lg);
        font-size: var(--fs-sm);
        align-items: flex-start;
        padding-top: 2px;
      }
      .site-footer__nav a {
        color: var(--c-text-muted);
        transition: color var(--transition);
      }
      .site-footer__nav a:hover {
        color: var(--c-accent);
      }

      .github-link {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: 0.5rem;
        color: var(--c-text-muted);
        transition:
          color 0.15s,
          transform 0.15s;
        vertical-align: middle;
      }
      .github-link:hover {
        color: #333; /* GitHub black */
        transform: scale(1.1);
      }
      @media (max-width: 768px) {
        .site-footer__inner {
          flex-direction: column;
          gap: var(--s-lg);
        }
      }

      @media (max-width: 768px) {
        .nav-toggle {
          display: block;
        }
        .site-nav {
          display: none;
          position: absolute;
          top: var(--header-height);
          left: 0;
          right: 0;
          background: var(--c-bg);
          flex-direction: column;
          padding: var(--s-md) var(--s-lg);
          border-bottom: 2px solid var(--c-accent);
          box-shadow: var(--shadow-md);
          gap: 0;
        }
        .site-nav.is-open {
          display: flex;
        }
        .site-nav a {
          font-size: var(--fs-base);
          padding: var(--s-sm) 0;
          border-bottom: 1px solid var(--c-border-light);
        }
        .site-nav a:last-child {
          border-bottom: none;
        }
        .site-header__logo-text {
          font-size: var(--fs-base);
        }
      }
    </style>

    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("nav-toggle");
        const nav = document.getElementById("site-nav");
        if (!btn || !nav) return;
        btn.addEventListener("click", () => {
          const open = btn.getAttribute("aria-expanded") === "true";
          btn.setAttribute("aria-expanded", String(!open));
          nav.classList.toggle("is-open", !open);
        });
        // Close menu when clicking a link
        nav.querySelectorAll("a").forEach((a) => {
          a.addEventListener("click", () => {
            btn.setAttribute("aria-expanded", "false");
            nav.classList.remove("is-open");
          });
        });
      });
    </script>
  </body>
</html>
